# P0 功能验收测试方案

**测试日期**: 2026-02-25
**测试范围**: 配置向导 + 服务启停 P0 功能
**测试类型**: 用户验收测试 (UAT)

---

## 📋 测试准备

### 1. 环境检查

```bash
# 检查后端服务
curl http://127.0.0.1:8420/api/health

# 检查前端构建
cd apps/desktop && npm run build

# 启动桌面应用
cd apps/desktop && npm run tauri dev
```

### 2. 测试数据准备

- ✅ 后端服务运行中
- ✅ 配置文件位置：`~/.deskflow/config.json`
- ✅ PID 文件位置：`~/.deskflow/service.pid`

---

## 🧪 测试用例

### TC-001: 配置向导 - 模式选择

**前置条件**: 首次启动应用，未完成配置

**测试步骤**:
1. 启动桌面应用
2. 观察是否显示配置向导模式选择界面

**预期结果**:
- [ ] 显示"快速配置"和"完整向导"两个卡片
- [ ] 快速配置卡片显示 3 步说明
- [ ] 完整向导卡片显示 8 步说明
- [ ] 点击任一卡片进入对应模式

**截图位置**: `test-output/uat-001-mode-select.png`

---

### TC-002: 快速配置 - LLM 配置

**前置条件**: 已选择快速配置模式

**测试步骤**:
1. 进入快速配置第 1 步
2. 选择服务商（通义千问/OpenAI/Anthropic）
3. 填写 API Key
4. 选择模型
5. 点击"测试连接"按钮

**预期结果**:
- [ ] 服务商下拉列表显示 3 个选项
- [ ] 切换服务商时 Base URL 自动更新
- [ ] API Key 输入框支持显示/隐藏
- [ ] 模型下拉列表显示对应服务商的模型
- [ ] 测试连接显示成功/失败状态
- [ ] 测试成功显示延迟时间

**测试数据**:
- 服务商：通义千问
- API Key：`sk-xxxxx`
- 模型：`qwen3.5-plus`

**截图位置**: `test-output/uat-002-llm-config.png`

---

### TC-003: 快速配置 - IM 配置

**前置条件**: 已完成 LLM 配置，进入第 2 步

**测试步骤**:
1. 进入快速配置第 2 步
2. 选择 IM 渠道（飞书/企业微信/钉钉等）
3. 填写对应配置信息
4. 点击"下一步"

**预期结果**:
- [ ] 显示 7 种 IM 渠道选项
- [ ] 切换渠道时显示对应配置字段
- [ ] 敏感字段支持显示/隐藏
- [ ] 提供配置说明链接
- [ ] 支持跳过（可选配置）

**截图位置**: `test-output/uat-003-im-config.png`

---

### TC-004: 快速配置 - 自动配置

**前置条件**: 已完成 IM 配置，进入第 3 步

**测试步骤**:
1. 进入快速配置第 3 步
2. 查看配置摘要
3. 点击"开始配置"按钮
4. 观察配置进度

**预期结果**:
- [ ] 显示配置摘要（服务商、模型、IM 渠道、工作区）
- [ ] 点击开始后显示进度条
- [ ] 显示当前任务描述
- [ ] 显示实时日志输出
- [ ] 配置完成后显示成功状态
- [ ] 自动跳转到主界面

**进度检查点**:
- [ ] 20% - 创建工作区
- [ ] 40% - 检查 Python
- [ ] 60% - 安装依赖
- [ ] 80% - 保存配置
- [ ] 100% - 启动服务

**截图位置**: `test-output/uat-004-auto-config.png`

---

### TC-005: 完整向导 - 步骤导航

**前置条件**: 选择完整向导模式

**测试步骤**:
1. 观察左侧步骤列表
2. 点击各个步骤
3. 使用上一步/下一步按钮导航

**预期结果**:
- [ ] 左侧显示 8 个步骤列表
- [ ] 当前步骤高亮显示
- [ ] 已完成步骤显示完成图标
- [ ] 点击步骤可跳转到对应步骤
- [ ] 上一步/下一步按钮工作正常
- [ ] 第 1 步显示"返回"而非"上一步"

**截图位置**: `test-output/uat-005-wizard-navigation.png`

---

### TC-006: 完整向导 - LLM 配置 (Step 5)

**前置条件**: 导航到第 5 步

**测试步骤**:
1. 进入第 5 步 LLM 端点配置
2. 填写 LLM 配置
3. 测试连接
4. 点击"下一步"

**预期结果**:
- [ ] 显示 LLM 配置表单（与快速配置一致）
- [ ] 表单验证工作正常
- [ ] 测试连接功能正常
- [ ] 下一步按钮可点击

**截图位置**: `test-output/uat-006-full-llm.png`

---

### TC-007: 完整向导 - IM 配置 (Step 6)

**前置条件**: 导航到第 6 步

**测试步骤**:
1. 进入第 6 步 IM 通道配置
2. 填写 IM 配置
3. 点击"下一步"

**预期结果**:
- [ ] 显示 IM 配置表单（与快速配置一致）
- [ ] 表单验证工作正常
- [ ] 下一步按钮可点击

**截图位置**: `test-output/uat-007-full-im.png`

---

### TC-008: 完整向导 - 完成 (Step 8)

**前置条件**: 导航到第 8 步

**测试步骤**:
1. 进入第 8 步完成
2. 点击"开始配置"
3. 观察配置过程

**预期结果**:
- [ ] 显示自动配置组件
- [ ] 配置流程与快速配置一致
- [ ] 配置完成后进入主界面

**截图位置**: `test-output/uat-008-full-complete.png`

---

### TC-009: 服务监控 - 状态显示

**前置条件**: 已完成配置，进入主界面

**测试步骤**:
1. 点击左侧导航"监控"进入 MonitorView
2. 观察服务状态卡片

**预期结果**:
- [ ] 显示服务状态卡片在顶部
- [ ] 显示服务图标和状态指示器
- [ ] 显示"运行中"或"已停止"状态
- [ ] 显示进程 PID（如果运行中）
- [ ] 显示内存和 CPU 使用（如果运行中）

**截图位置**: `test-output/uat-009-service-status.png`

---

### TC-010: 服务监控 - 启动服务

**前置条件**: 服务处于停止状态

**测试步骤**:
1. 点击"启动"按钮
2. 观察按钮状态变化
3. 等待服务启动

**预期结果**:
- [ ] 点击后按钮显示加载状态
- [ ] 按钮禁用防止重复点击
- [ ] 服务启动后状态变为"运行中"
- [ ] 显示 PID 和资源使用信息
- [ ] 状态指示器变为绿色并闪烁

**截图位置**: `test-output/uat-010-service-start.png`

---

### TC-011: 服务监控 - 停止服务

**前置条件**: 服务处于运行状态

**测试步骤**:
1. 点击"停止"按钮
2. 观察按钮状态变化
3. 等待服务停止

**预期结果**:
- [ ] 点击后按钮显示加载状态
- [ ] 按钮禁用防止重复点击
- [ ] 服务停止后状态变为"已停止"
- [ ] PID 和资源信息清空
- [ ] 状态指示器变为灰色

**截图位置**: `test-output/uat-011-service-stop.png`

---

### TC-012: 服务监控 - 查看日志

**前置条件**: 服务已启动

**测试步骤**:
1. 点击"查看日志"按钮
2. 观察日志显示

**预期结果**:
- [ ] 按钮存在且可点击
- [ ] 点击后显示日志查看界面（或预留功能提示）

**截图位置**: `test-output/uat-012-service-logs.png`

---

### TC-013: 状态卡片 - 系统状态

**前置条件**: 已进入 MonitorView

**测试步骤**:
1. 观察 4 个状态卡片
2. 检查每个卡片的信息

**预期结果**:
- [ ] Agent 状态 - 显示在线/离线
- [ ] 记忆状态 - 显示记忆条目数量
- [ ] LLM 状态 - 显示已连接/未配置和模型名
- [ ] 工具状态 - 显示可用技能数量
- [ ] 状态指示器颜色正确

**截图位置**: `test-output/uat-013-status-cards.png`

---

### TC-014: 资源监控 - 使用率显示

**前置条件**: 已进入 MonitorView

**测试步骤**:
1. 观察资源监控面板
2. 检查各项资源使用率

**预期结果**:
- [ ] CPU 使用率显示和进度条
- [ ] 内存使用率显示和进度条
- [ ] 磁盘使用率显示和进度条
- [ ] 数据盘使用率显示和进度条
- [ ] 运行时间显示
- [ ] 平台信息显示

**截图位置**: `test-output/uat-014-resources.png`

---

### TC-015: 活动时间线 - 过滤功能

**前置条件**: 已进入 MonitorView

**测试步骤**:
1. 观察活动时间线面板
2. 点击不同的过滤按钮（全部/LLM/工具/记忆）
3. 检查活动列表变化

**预期结果**:
- [ ] 显示最近活动列表
- [ ] 每个活动显示图标、文本、时间、标签
- [ ] 过滤按钮工作正常
- [ ] 无活动时显示占位提示

**截图位置**: `test-output/uat-015-activity.png`

---

### TC-016: 刷新功能

**前置条件**: 已进入 MonitorView

**测试步骤**:
1. 点击"刷新"按钮
2. 观察数据更新

**预期结果**:
- [ ] 点击后显示加载状态
- [ ] 数据重新获取
- [ ] 时间戳更新

**截图位置**: `test-output/uat-016-refresh.png`

---

### TC-017: 后端 API 验证

**前置条件**: 后端服务运行

**测试步骤**:
```bash
# 1. 获取服务状态
curl http://127.0.0.1:8420/api/monitor/service/status

# 2. 获取配置
curl http://127.0.0.1:8420/api/setup/config

# 3. 获取模型列表
curl "http://127.0.0.1:8420/api/llm/models?provider=dashscope"

# 4. 保存配置
curl -X POST http://127.0.0.1:8420/api/setup/config \
  -H "Content-Type: application/json" \
  -d '{"llm":{...}}'

# 5. 启动服务
curl -X POST http://127.0.0.1:8420/api/monitor/service/start

# 6. 停止服务
curl -X POST http://127.0.0.1:8420/api/monitor/service/stop
```

**预期结果**:
- [ ] 所有 API 返回 200 状态码
- [ ] 响应数据格式正确
- [ ] 配置保存后文件存在

---

### TC-018: 配置持久化验证

**前置条件**: 已完成配置

**测试步骤**:
```bash
# 检查配置文件
cat ~/.deskflow/config.json

# 检查 PID 文件
cat ~/.deskflow/service.pid
```

**预期结果**:
- [ ] 配置文件存在且内容正确
- [ ] 配置文件包含 LLM 配置
- [ ] 配置文件包含工作区配置
- [ ] PID 文件在服务启动时存在

---

## 📊 测试结果记录

### 测试执行记录

| TC 编号 | 测试名称 | 执行时间 | 结果 | 备注 |
|--------|---------|---------|------|------|
| TC-001 | 模式选择 | | ⏳ 待测试 | |
| TC-002 | LLM 配置 | | ⏳ 待测试 | |
| TC-003 | IM 配置 | | ⏳ 待测试 | |
| TC-004 | 自动配置 | | ⏳ 待测试 | |
| TC-005 | 向导导航 | | ⏳ 待测试 | |
| TC-006 | 完整向导 LLM | | ⏳ 待测试 | |
| TC-007 | 完整向导 IM | | ⏳ 待测试 | |
| TC-008 | 完整向导完成 | | ⏳ 待测试 | |
| TC-009 | 服务状态显示 | | ⏳ 待测试 | |
| TC-010 | 启动服务 | | ⏳ 待测试 | |
| TC-011 | 停止服务 | | ⏳ 待测试 | |
| TC-012 | 查看日志 | | ⏳ 待测试 | |
| TC-013 | 状态卡片 | | ⏳ 待测试 | |
| TC-014 | 资源监控 | | ⏳ 待测试 | |
| TC-015 | 活动时间线 | | ⏳ 待测试 | |
| TC-016 | 刷新功能 | | ⏳ 待测试 | |
| TC-017 | 后端 API | | ⏳ 待测试 | |
| TC-018 | 配置持久化 | | ⏳ 待测试 | |

### 问题记录

| 编号 | 关联 TC | 问题描述 | 严重程度 | 状态 |
|------|--------|---------|---------|------|
| | | | | |

---

## ✅ 验收标准

### 必须通过 (P0)
- [ ] TC-001: 模式选择功能正常
- [ ] TC-002: LLM 配置功能正常
- [ ] TC-004: 自动配置流程完成
- [ ] TC-009: 服务状态显示正确
- [ ] TC-010: 服务启动功能正常
- [ ] TC-011: 服务停止功能正常
- [ ] TC-017: 所有后端 API 正常
- [ ] TC-018: 配置持久化正常

### 建议通过 (P1)
- [ ] TC-003: IM 配置功能正常
- [ ] TC-005: 向导导航功能正常
- [ ] TC-013: 状态卡片显示正确
- [ ] TC-014: 资源监控显示正确
- [ ] TC-015: 活动时间线过滤正常

### 可选通过 (P2)
- [ ] TC-006: 完整向导 LLM
- [ ] TC-007: 完整向导 IM
- [ ] TC-008: 完整向导完成
- [ ] TC-012: 查看日志功能
- [ ] TC-016: 刷新功能

---

## 📸 截图收集

请在测试过程中截图并保存到 `test-output/` 目录：

```
test-output/
├── uat-001-mode-select.png
├── uat-002-llm-config.png
├── uat-003-im-config.png
├── uat-004-auto-config.png
├── uat-005-wizard-navigation.png
├── uat-006-full-llm.png
├── uat-007-full-im.png
├── uat-008-full-complete.png
├── uat-009-service-status.png
├── uat-010-service-start.png
├── uat-011-service-stop.png
├── uat-012-service-logs.png
├── uat-013-status-cards.png
├── uat-014-resources.png
├── uat-015-activity.png
└── uat-016-refresh.png
```

---

## 📝 测试报告模板

测试完成后，请填写以下信息：

### 测试摘要
- 测试执行时间：
- 测试执行人：
- 测试环境：

### 测试结果
- 通过用例数：/ 18
- 失败用例数：
- 阻塞问题数：

### 测试结论
- [ ] 通过 - 所有 P0 用例通过
- [ ] 有条件通过 - P0 用例通过，P1/P2 有部分问题
- [ ] 不通过 - 有关键功能失败

### 遗留问题
（列出所有未解决的问题）

### 建议
（改进建议和新功能建议）

---

**测试方案版本**: v1.0
**编制人**: Claude Code
**审批状态**: 待用户确认
